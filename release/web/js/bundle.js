!function(){"use strict";class e extends Laya.Dialog{constructor(){super(),this.timeLine=new Laya.TimeLine}onEnable(){UIConfig.closeDialogOnSide=!1;this.beginBtn=this.getChildByName("beginBtn"),this.closeBtn=this.getChildByName("closeBtn"),this.beginImage=this.getChildByName("beginImage"),this.beginBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.closeBtn.on(Laya.Event.CLICK,this,this.onCloseBtnClick),this.beginImage.on(Laya.Event.CLICK,this,this.onBtnClick),this.createTimerLine()}createTimerLine(){this.timeLine.addLabel("turnSmall",0).to(this.beginBtn,{scaleX:.9,scaleY:.9},500,null,0).addLabel("turnBig",0).to(this.beginBtn,{scaleX:1,scaleY:1},500,null,0).addLabel("turnBig",0).to(this.beginBtn,{scaleX:1.1,scaleY:1.1},500,null,0).addLabel("turnBig",0).to(this.beginBtn,{scaleX:1,scaleY:1},500,null,0),this.timeLine.play(0,!0)}onBtnClick(){parent.postMessage({stage:"go"},"*"),Laya.Scene.open("test/TestScene.json")}onCloseBtnClick(){parent.postMessage({stage:"close-icon"},"*")}}var t,s=Laya.ClassUtils.regClass;!function(e){!function(e){class t extends Laya.Scene{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("test/TestScene")}}e.TestSceneUI=t,s("ui.test.TestSceneUI",t)}(e.test||(e.test={}))}(t||(t={}));class a extends Laya.Script{constructor(){super(),this.createBoxInterval=600,this._time=0,this._started=!1}onEnable(){this._time=Date.now(),this._gameBox=this.owner.getChildByName("gameBox"),Laya.loader.load("prefab/fireworks.part")}onUpdate(){let e=Date.now();e-this._time>this.createBoxInterval&&this._started&&(this._time=e,this.createBox())}createBox(){let e=Laya.Pool.getItemByCreateFun("dropBox",this.dropBox.create,this.dropBox);e.pos(Math.random()*(Laya.stage.width-150)+50,-100),this._gameBox.addChild(e)}onStageClick(e){e.stopPropagation()}startGame(){this._started||(this._started=!0,this.enabled=!0)}stopGame(){this._started=!1,this.enabled=!1,this.createBoxInterval=1e3,Laya.timer.once(2e3,this,()=>{Laya.Scene.open("test/Dialog/ResltDialog.json")})}}class i extends t.test.TestSceneUI{constructor(){super(),this.doubleNum=0,this.downNum=10,i.instance=this,UIConfig.popupBgAlpha=.3}onEnable(){console.log("gameUI"),document.getElementById("bgImg").style.display="inline",Laya.Scene.open("test/Dialog/ReadyDialog.json"),this._control=this.getComponent(a)}downTime(){2==this.downNum&&this.stopGame(),this.downNum<=0&&Laya.timer.clear(this,this.downTime),this.downTimeNum.text=this.downNum+"",this.downNum>0&&this.downNum--}initDoubleNum(){Laya.Tween.to(this.double,{x:-565,ease:Laya.Ease.backOut,complete:Laya.Handler.create(this,()=>{this.double.visible=!1})},500),this.doubleNum=0,this.double.skin="game/2.png"}showDoubleNum(){Laya.timer.clear(this,this.initDoubleNum),this.doubleNum++,this.doubleNum>=2&&(this.doubleNum>=17&&(this.doubleNum=17),this.double.skin=`game/${this.doubleNum}.png`,this.double.x=668,this.double.visible=!0,Laya.Tween.to(this.double,{x:44,ease:Laya.Ease.backOut},500)),Laya.timer.once(1e3,this,this.initDoubleNum)}addScore(e=1){this.score<15&&(this.score+=e),this.showDoubleNum(),this.iconProcess.width=112+462*this.score/15,this._control.createBoxInterval>600&&this.score%20==0&&(this._control.createBoxInterval-=20)}startGame(){this.score=0,this._control.startGame(),this.timeBox.y=-200,this.timeBox.visible=!0,Laya.Tween.to(this.timeBox,{y:24,ease:Laya.Ease.backOut},500),this.processBox.y=-200,this.processBox.visible=!0,Laya.Tween.to(this.processBox,{y:53,ease:Laya.Ease.backOut},500),Laya.timer.loop(1e3,this,this.downTime)}stopGame(){this._control.stopGame(),Laya.timer.once(2e3,this,()=>{this.timeBox.visible=!1,this.processBox.visible=!1})}}class o extends Laya.Dialog{constructor(){super(),this.numn=3}onEnable(){UIConfig.closeDialogOnSide=!1,this.numbers=this.getChildByName("numbers"),this.timeLine(),Laya.timer.loop(1e3,this,this.timeLine)}timeLine(){let e=this.numn;switch(this.numn--,!0){case e>1:this.numbers.scale(1.3,1.3),this.numbers.skin=`game/iconlbl_${e}.png`,Laya.Tween.to(this.numbers,{scaleX:.8,scaleY:.8,ease:Laya.Ease.circInOut},1e3);break;case 1==e:this.numbers.skin=`game/iconlbl_${e}.png`,this.numbers.x=310,this.numbers.width=127,this.numbers.height=322,this.numbers.scale(1.3,1.3),Laya.Tween.to(this.numbers,{scaleX:.8,scaleY:.8,ease:Laya.Ease.circInOut},1e3);break;case 0==e:this.numbers.skin=`game/iconlbl_${e}.png`,this.numbers.x=328,this.numbers.y=673,this.numbers.width=324,this.numbers.height=167,this.numbers.anchorX=.5,this.numbers.anchorY=.5,this.numbers.scale(1.3,1.3),Laya.Tween.to(this.numbers,{scaleX:.8,scaleY:.8,ease:Laya.Ease.circInOut},1e3);break;default:Laya.timer.clear(this,this.timeLine),this.close(),i.instance.startGame()}}}class n extends Laya.Dialog{constructor(){super()}onEnable(){console.log(1),UIConfig.closeDialogOnSide=!1,this.timeText=this.getChildByName("time"),this.useBtn=this.getChildByName("useBtn"),this.text1=this.getChildByName("text1"),this.text2=this.getChildByName("text2"),this.text3=this.getChildByName("text2"),this.successBottom=this.getChildByName("successBottom"),this.successBox=this.getChildByName("successBox"),this.iconText=this.successBox.getChildByName("icon"),this.useBtn.on(Laya.Event.CLICK,this,this.onUseBtnClick);window.addEventListener("message",e=>{e.origin!=location.origin&&(console.log(e,"接送到的数据"),console.log(e.data,"接送到的数据"),"date"===e.data.type&&this.setDateTime(e.data.value),"success"===e.data.type&&this.setSuccessDialog(e.data.value),"error"===e.data.type&&this.setErrorDialog(e.data.value))},!1),console.log(0!==i.instance.score," gameover GameUI.instance.score !== 0"),parent.postMessage({stage:"gameover",isClick:0!==i.instance.score},"*"),0===i.instance.score&&(this.text1.visible=!0)}setDateTime(e){console.log(e,"setDateTime"),e?(this.timeText.text=e,this.timeText.visible=!0,this.text2.visible=!0):(this.timeText.visible=!1,this.text2.visible=!1)}setSuccessDialog(e){console.log(e,"setSuccessDialog"),this.text1.visible=!1,this.timeText.visible=!1,this.text2.visible=!1,this.text3.visible=!0,this.successBottom.visible=!0,this.successBox.visible=!0,this.text3.text="有效期"+e.date,this.text3.align="center",this.iconText.text=e.coin||0;let t=e.coin||0;t>9&&t<100&&(this.iconText.fontSize=70,this.iconText.x=292,this.iconText.y=-26),t>999&&(this.iconText.fontSize=35,this.iconText.x=292,this.iconText.y=-4),this.useBtn.skin="game/use_btn.png"}setErrorDialog(e){console.log(e,"setErrorDialog"),this.text1.text="很遗憾，本场红包雨已抢完",this.text1.fontSize=28,32548===e.code&&(this.text1.text=e.msg||"",this.text1.fontSize=22),this.text1.visible=!0}onUseBtnClick(){"game/use_btn.png"===this.useBtn.skin?parent.postMessage({stage:"used"},"*"):parent.postMessage({stage:"close-btn"},"*")}onBtnClick(){Laya.Scene.open("test/TestScene.json")}}class l extends Laya.Script{constructor(){super(),this.level=1}onEnable(){this._rig=this.owner.getComponent(Laya.RigidBody),this.level=1,this._redPick=this.owner.getChildByName("redPacker"),Math.random()<.08&&(this._redPick.skin="test/红包 2.png",this._redPick.scale(.75,.75),this._rig.gravityScale=.8)}onUpdate(){this.owner.rotation+=.3,this.owner.y>1736&&this.owner.removeSelf()}onClick(){var e=this.owner;if(e.parent){let t=new Laya.Particle2D(Laya.loader.getRes("prefab/fireworks.part"));t.pos(e.x,e.y),e.parent.addChild(t),t.play(),Laya.timer.once(600,this,()=>{t.destroy()}),e.removeSelf(),Laya.SoundManager.playSound("sound/destroy.wav")}i.instance.addScore(1)}createEffect(){return this.part=new Laya.Particle2D(Laya.loader.getRes("prefab/fireworks.part")),this.part}onDisable(){Laya.Pool.recover("dropBox",this.owner)}}class r{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("script/dialog/BeginDialog.ts",e),t("script/dialog/ReadyDialog.ts",o),t("script/dialog/ResltDialog.ts",n),t("script/GameUI.ts",i),t("script/GameControl.ts",a),t("script/DropBox.ts",l)}}r.width=640,r.height=1136,r.scaleMode="fixedauto",r.screenMode="none",r.alignV="middle",r.alignH="center",r.startScene="test/Dialog/BeginDialog.scene",r.sceneRoot="",r.debug=!1,r.stat=!1,r.physicsDebug=!1,r.exportSceneToJson=!0,r.init();new class{constructor(){window.hello=function(e){console.log(e,"xiachuangyi")},window.Laya3D?(Laya3D.init(r.width,r.height),Laya.stage.bgColor=null):(Config.isAlpha=!0,Laya.init(r.width,r.height,Laya.WebGL),Laya.stage.bgColor="none"),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=r.scaleMode,Laya.stage.screenMode=r.screenMode,Laya.stage.alignV=r.alignV,Laya.stage.alignH=r.alignH,Laya.URL.exportSceneToJson=r.exportSceneToJson,(r.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),r.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),r.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),Laya.stage.bgColor=null}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onImgLoaded))}onImgLoaded(){var e=[{url:"res/atlas/game.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/game.png",type:Laya.Loader.IMAGE}];Laya.loader.load(e,null,Laya.Handler.create(this,this.onConfigLoaded,null,!1))}onConfigLoaded(){r.startScene&&Laya.Scene.open(r.startScene)}}}();